/*! howler.js v2.0.1 | (c) 2013-2016, James Simpson of GoldFire Studios | MIT License | howlerjs.com */
function shareButtonReadSyncer(){setTimeout(function(){!function(e,t,n){var i,o=e.getElementsByTagName(t)[0];e.getElementById(n)||((i=e.createElement(t)).id=n,i.src="//connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.0",o.parentNode.insertBefore(i,o))}(document,"script","facebook-jssdk");e=document.createElement("script");e.type="text/javascript",e.src="https://apis.google.com/js/platform.js",e.async=!0,document.getElementsByTagName("head")[0].appendChild(e);var e;(e=document.createElement("script")).type="text/javascript",e.src="https://b.st-hatena.com/js/bookmark_button.js",e.async=!0,document.getElementsByTagName("head")[0].appendChild(e),function(e,t){if(!e.getElementById(t)){var n=e.createElement("script");n.id=t,n.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";e.getElementById(t);e.body.appendChild(n)}}(document,"pocket-btn-js")},1e3)}!function(){"use strict";var e=function(){this.init()};e.prototype={init:function(){var e=this||t;return e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var n=this||t;if(e=parseFloat(e),n.ctx||d(),void 0!==e&&e>=0&&e<=1){if(n._volume=e,n._muted)return n;n.usingWebAudio&&(n.masterGain.gain.value=e);for(var i=0;i<n._howls.length;i++)if(!n._howls[i]._webAudio)for(var o=n._howls[i]._getSoundIds(),a=0;a<o.length;a++){var r=n._howls[i]._soundById(o[a]);r&&r._node&&(r._node.volume=r._volume*e)}return n}return n._volume},mute:function(e){var n=this||t;n.ctx||d(),n._muted=e,n.usingWebAudio&&(n.masterGain.gain.value=e?0:n._volume);for(var i=0;i<n._howls.length;i++)if(!n._howls[i]._webAudio)for(var o=n._howls[i]._getSoundIds(),a=0;a<o.length;a++){var r=n._howls[i]._soundById(o[a]);r&&r._node&&(r._node.muted=!!e||r._muted)}return n},unload:function(){for(var e=this||t,n=e._howls.length-1;n>=0;n--)e._howls[n].unload();return e.usingWebAudio&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,d()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;return e.state=e.ctx?e.ctx.state||"running":"running",e._autoSuspend(),e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,n="undefined"!=typeof Audio?new Audio:null;if(!n||"function"!=typeof n.canPlayType)return e;var i=n.canPlayType("audio/mpeg;").replace(/^no$/,""),o=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),a=o&&parseInt(o[0].split("/")[1],10)<33;return e._codecs={mp3:!(a||!i&&!n.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!n.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!n.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!n.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/m4a;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(n.canPlayType("audio/x-mp4;")||n.canPlayType("audio/mp4;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!n.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(n.canPlayType("audio/x-flac;")||n.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||t,n=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),i=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(n||i)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var o=function(){var t=e.ctx.createBufferSource();t.buffer=e._scratchBuffer,t.connect(e.ctx.destination),void 0===t.start?t.noteOn(0):t.start(0),t.onended=function(){t.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchend",o,!0)}};return document.addEventListener("touchend",o,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&t.usingWebAudio){for(var n=0;n<e._howls.length;n++)if(e._howls[n]._webAudio)for(var i=0;i<e._howls[n]._sounds.length;i++)if(!e._howls[n]._sounds[i]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&t.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.state="resuming",e.ctx.resume().then(function(){e.state="running"}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var t=new e,n=function(e){return e.src&&0!==e.src.length?void this.init(e):void console.error("An array of source files must be passed with any new Howl.")};n.prototype={init:function(e){var n=this;return t.ctx||d(),n._autoplay=e.autoplay||!1,n._format="string"!=typeof e.format?e.format:[e.format],n._html5=e.html5||!1,n._muted=e.mute||!1,n._loop=e.loop||!1,n._pool=e.pool||5,n._preload="boolean"!=typeof e.preload||e.preload,n._rate=e.rate||1,n._sprite=e.sprite||{},n._src="string"!=typeof e.src?e.src:[e.src],n._volume=void 0!==e.volume?e.volume:1,n._duration=0,n._state="unloaded",n._sounds=[],n._endTimers={},n._queue=[],n._onend=e.onend?[{fn:e.onend}]:[],n._onfade=e.onfade?[{fn:e.onfade}]:[],n._onload=e.onload?[{fn:e.onload}]:[],n._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],n._onpause=e.onpause?[{fn:e.onpause}]:[],n._onplay=e.onplay?[{fn:e.onplay}]:[],n._onstop=e.onstop?[{fn:e.onstop}]:[],n._onmute=e.onmute?[{fn:e.onmute}]:[],n._onvolume=e.onvolume?[{fn:e.onvolume}]:[],n._onrate=e.onrate?[{fn:e.onrate}]:[],n._onseek=e.onseek?[{fn:e.onseek}]:[],n._webAudio=t.usingWebAudio&&!n._html5,void 0!==t.ctx&&t.ctx&&t.mobileAutoEnable&&t._enableMobileAudio(),t._howls.push(n),n._preload&&n.load(),n},load:function(){var e=this,n=null;{if(!t.noAudio){"string"==typeof e._src&&(e._src=[e._src]);for(var o=0;o<e._src.length;o++){var r,s;if(e._format&&e._format[o])r=e._format[o];else{if("string"!=typeof(s=e._src[o])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(s))||(r=/\.([^.]+)$/.exec(s.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(t.codecs(r)){n=e._src[o];break}}return n?(e._src=n,e._state="loading","https:"===window.location.protocol&&"http:"===n.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new i(e),e._webAudio&&a(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")}e._emit("loaderror",null,"No audio support.")}},play:function(e,n){var i=this,o=null;if("number"==typeof e)o=e,e=null;else{if("string"==typeof e&&"loaded"===i._state&&!i._sprite[e])return null;if(void 0===e){e="__default";for(var a=0,r=0;r<i._sounds.length;r++)i._sounds[r]._paused&&!i._sounds[r]._ended&&(a++,o=i._sounds[r]._id);1===a?e=null:o=null}}var s=o?i._soundById(o):i._inactiveSound();if(!s)return null;if(o&&!e&&(e=s._sprite||"__default"),"loaded"!==i._state&&!i._sprite[e])return i._queue.push({event:"play",action:function(){i.play(i._soundById(s._id)?s._id:void 0)}}),s._id;if(o&&!s._paused)return n||setTimeout(function(){i._emit("play",s._id)},0),s._id;i._webAudio&&t._autoResume();var u=s._seek>0?s._seek:i._sprite[e][0]/1e3,d=(i._sprite[e][0]+i._sprite[e][1])/1e3-u,_=1e3*d/Math.abs(s._rate);s._paused=!1,s._ended=!1,s._sprite=e,s._seek=u,s._start=i._sprite[e][0]/1e3,s._stop=(i._sprite[e][0]+i._sprite[e][1])/1e3,s._loop=!(!s._loop&&!i._sprite[e][2]);var l=s._node;if(i._webAudio){var c=function(){i._refreshBuffer(s);var e=s._muted||i._muted?0:s._volume;l.gain.setValueAtTime(e,t.ctx.currentTime),s._playStart=t.ctx.currentTime,void 0===l.bufferSource.start?s._loop?l.bufferSource.noteGrainOn(0,u,86400):l.bufferSource.noteGrainOn(0,u,d):s._loop?l.bufferSource.start(0,u,86400):l.bufferSource.start(0,u,d),_!==1/0&&(i._endTimers[s._id]=setTimeout(i._ended.bind(i,s),_)),n||setTimeout(function(){i._emit("play",s._id)},0)};"loaded"===i._state?c():(i.once("load",c,s._id),i._clearTimer(s._id))}else{var f=function(){l.currentTime=u,l.muted=s._muted||i._muted||t._muted||l.muted,l.volume=s._volume*t.volume(),l.playbackRate=s._rate,setTimeout(function(){l.play(),_!==1/0&&(i._endTimers[s._id]=setTimeout(i._ended.bind(i,s),_)),n||i._emit("play",s._id)},0)},h="loaded"===i._state&&(window&&window.ejecta||!l.readyState&&t._navigator.isCocoonJS);if(4===l.readyState||h)f();else{var p=function(){f(),l.removeEventListener(t._canPlayEvent,p,!1)};l.addEventListener(t._canPlayEvent,p,!1),i._clearTimer(s._id)}}return s._id},pause:function(e){var t=this;if("loaded"!==t._state)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),i=0;i<n.length;i++){t._clearTimer(n[i]);var o=t._soundById(n[i]);if(o&&!o._paused){if(o._seek=t.seek(n[i]),o._rateSeek=0,o._paused=!0,t._stopFade(n[i]),o._node)if(t._webAudio){if(!o._node.bufferSource)return t;void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),t._cleanBuffer(o._node)}else isNaN(o._node.duration)&&o._node.duration!==1/0||o._node.pause();arguments[1]||t._emit("pause",o._id)}}return t},stop:function(e,t){var n=this;if("loaded"!==n._state)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var i=n._getSoundIds(e),o=0;o<i.length;o++){n._clearTimer(i[o]);var a=n._soundById(i[o]);if(a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,n._stopFade(i[o]),a._node))if(n._webAudio){if(!a._node.bufferSource)return t||n._emit("stop",a._id),n;void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),n._cleanBuffer(a._node)}else isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause());a&&!t&&n._emit("stop",a._id)}return n},mute:function(e,n){var i=this;if("loaded"!==i._state)return i._queue.push({event:"mute",action:function(){i.mute(e,n)}}),i;if(void 0===n){if("boolean"!=typeof e)return i._muted;i._muted=e}for(var o=i._getSoundIds(n),a=0;a<o.length;a++){var r=i._soundById(o[a]);r&&(r._muted=e,i._webAudio&&r._node?r._node.gain.setValueAtTime(e?0:r._volume,t.ctx.currentTime):r._node&&(r._node.muted=!!t._muted||e),i._emit("mute",r._id))}return i},volume:function(){var e,n,i=this,o=arguments;if(0===o.length)return i._volume;if(1===o.length||2===o.length&&void 0===o[1]){i._getSoundIds().indexOf(o[0])>=0?n=parseInt(o[0],10):e=parseFloat(o[0])}else o.length>=2&&(e=parseFloat(o[0]),n=parseInt(o[1],10));var a;if(!(void 0!==e&&e>=0&&e<=1))return(a=n?i._soundById(n):i._sounds[0])?a._volume:0;if("loaded"!==i._state)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,o)}}),i;void 0===n&&(i._volume=e),n=i._getSoundIds(n);for(var r=0;r<n.length;r++)(a=i._soundById(n[r]))&&(a._volume=e,o[2]||i._stopFade(n[r]),i._webAudio&&a._node&&!a._muted?a._node.gain.setValueAtTime(e,t.ctx.currentTime):a._node&&!a._muted&&(a._node.volume=e*t.volume()),i._emit("volume",a._id));return i},fade:function(e,n,i,o){var a=this,r=Math.abs(e-n),s=e>n?"out":"in",u=r/.01,d=u>0?i/u:i;if(d<4&&(u=Math.ceil(u/(4/d)),d=4),"loaded"!==a._state)return a._queue.push({event:"fade",action:function(){a.fade(e,n,i,o)}}),a;a.volume(e,o);for(var _=a._getSoundIds(o),l=0;l<_.length;l++){var c=a._soundById(_[l]);if(c){if(o||a._stopFade(_[l]),a._webAudio&&!c._muted){var f=t.ctx.currentTime,h=f+i/1e3;c._volume=e,c._node.gain.setValueAtTime(e,f),c._node.gain.linearRampToValueAtTime(n,h)}var p=e;c._interval=setInterval(function(e,t){u>0&&(p+="in"===s?.01:-.01),p=Math.max(0,p),p=Math.min(1,p),p=Math.round(100*p)/100,a._webAudio?(void 0===o&&(a._volume=p),t._volume=p):a.volume(p,e,!0),p===n&&(clearInterval(t._interval),t._interval=null,a.volume(p,e),a._emit("fade",e))}.bind(a,_[l],c),d)}}return a},_stopFade:function(e){var n=this,i=n._soundById(e);return i&&i._interval&&(n._webAudio&&i._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(i._interval),i._interval=null,n._emit("fade",e)),n},loop:function(){var e,t,n,i=this,o=arguments;if(0===o.length)return i._loop;if(1===o.length){if("boolean"!=typeof o[0])return!!(n=i._soundById(parseInt(o[0],10)))&&n._loop;e=o[0],i._loop=e}else 2===o.length&&(e=o[0],t=parseInt(o[1],10));for(var a=i._getSoundIds(t),r=0;r<a.length;r++)(n=i._soundById(a[r]))&&(n._loop=e,i._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop)));return i},rate:function(){var e,n,i=this,o=arguments;if(0===o.length)n=i._sounds[0]._id;else if(1===o.length){i._getSoundIds().indexOf(o[0])>=0?n=parseInt(o[0],10):e=parseFloat(o[0])}else 2===o.length&&(e=parseFloat(o[0]),n=parseInt(o[1],10));var a;if("number"!=typeof e)return(a=i._soundById(n))?a._rate:i._rate;if("loaded"!==i._state)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,o)}}),i;void 0===n&&(i._rate=e),n=i._getSoundIds(n);for(var r=0;r<n.length;r++)if(a=i._soundById(n[r])){a._rateSeek=i.seek(n[r]),a._playStart=i._webAudio?t.ctx.currentTime:a._playStart,a._rate=e,i._webAudio&&a._node&&a._node.bufferSource?a._node.bufferSource.playbackRate.value=e:a._node&&(a._node.playbackRate=e);var s=i.seek(n[r]),u=1e3*((i._sprite[a._sprite][0]+i._sprite[a._sprite][1])/1e3-s)/Math.abs(a._rate);!i._endTimers[n[r]]&&a._paused||(i._clearTimer(n[r]),i._endTimers[n[r]]=setTimeout(i._ended.bind(i,a),u)),i._emit("rate",a._id)}return i},seek:function(){var e,n,i=this,o=arguments;if(0===o.length)n=i._sounds[0]._id;else if(1===o.length){i._getSoundIds().indexOf(o[0])>=0?n=parseInt(o[0],10):(n=i._sounds[0]._id,e=parseFloat(o[0]))}else 2===o.length&&(e=parseFloat(o[0]),n=parseInt(o[1],10));if(void 0===n)return i;if("loaded"!==i._state)return i._queue.push({event:"seek",action:function(){i.seek.apply(i,o)}}),i;var a=i._soundById(n);if(a){if(!("number"==typeof e&&e>=0)){if(i._webAudio){var r=i.playing(n)?t.ctx.currentTime-a._playStart:0,s=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(s+r*Math.abs(a._rate))}return a._node.currentTime}var u=i.playing(n);u&&i.pause(n,!0),a._seek=e,a._ended=!1,i._clearTimer(n),u&&i.play(n,!0),!i._webAudio&&a._node&&(a._node.currentTime=e),i._emit("seek",n)}return i},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var i=0;i<t._sounds.length;i++)if(!t._sounds[i]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,i=t._soundById(e);return i&&(n=t._sprite[i._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,n=e._sounds,i=0;i<n.length;i++){n[i]._paused||(e.stop(n[i]._id),e._emit("end",n[i]._id)),e._webAudio||(n[i]._node.src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",n[i]._node.removeEventListener("error",n[i]._errorFn,!1),n[i]._node.removeEventListener(t._canPlayEvent,n[i]._loadFn,!1)),delete n[i]._node,e._clearTimer(n[i]._id);var a=t._howls.indexOf(e);a>=0&&t._howls.splice(a,1)}var r=!0;for(i=0;i<t._howls.length;i++)if(t._howls[i]._src===e._src){r=!1;break}return o&&r&&delete o[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,i){var o=this["_on"+e];return"function"==typeof t&&o.push(i?{id:n,fn:t,once:i}:{id:n,fn:t}),this},off:function(e,t,n){var i=this,o=i["_on"+e],a=0;if(t){for(a=0;a<o.length;a++)if(t===o[a].fn&&n===o[a].id){o.splice(a,1);break}}else if(e)i["_on"+e]=[];else{var r=Object.keys(i);for(a=0;a<r.length;a++)0===r[a].indexOf("_on")&&Array.isArray(i[r[a]])&&(i[r[a]]=[])}return i},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var i=this,o=i["_on"+e],a=o.length-1;a>=0;a--)o[a].id&&o[a].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(i,o[a].fn),0),o[a].once&&i.off(e,o[a].fn,o[a].id));return i},_loadQueue:function(){var e=this;if(e._queue.length>0){var t=e._queue[0];e.once(t.event,function(){e._queue.shift(),e._loadQueue()}),t.action()}return e},_ended:function(e){var n=this,i=e._sprite,o=!(!e._loop&&!n._sprite[i][2]);if(n._emit("end",e._id),!n._webAudio&&o&&n.stop(e._id,!0).play(e._id),n._webAudio&&o){n._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var a=1e3*(e._stop-e._start)/Math.abs(e._rate);n._endTimers[e._id]=setTimeout(n._ended.bind(n,e),a)}return n._webAudio&&!o&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,n._clearTimer(e._id),n._cleanBuffer(e._node),t._autoSuspend()),n._webAudio||o||n.stop(e._id),n},_clearTimer:function(e){var t=this;return t._endTimers[e]&&(clearTimeout(t._endTimers[e]),delete t._endTimers[e]),t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new i(e)},_drain:function(){var e=this,t=e._pool,n=0,i=0;if(!(e._sounds.length<t)){for(i=0;i<e._sounds.length;i++)e._sounds[i]._ended&&n++;for(i=e._sounds.length-1;i>=0;i--){if(n<=t)return;e._sounds[i]._ended&&(e._webAudio&&e._sounds[i]._node&&e._sounds[i]._node.disconnect(0),e._sounds.splice(i,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=o[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.value=e._rate,this},_cleanBuffer:function(e){var t=this;if(t._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}}return e.bufferSource=null,t}};var i=function(e){this._parent=e,this.init()};i.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._muted=t._muted,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=Math.round(Date.now()*Math.random()),t._sounds.push(e),e.create(),e},create:function(){var e=this,n=e._parent,i=t._muted||e._muted||e._parent._muted?0:e._volume;return n._webAudio?(e._node=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(i,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):(e._node=new Audio,e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._node.src=n._src,e._node.preload="auto",e._node.volume=i*t.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._muted=t._muted,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=Math.round(Date.now()*Math.random()),e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorListener,!1)},_loadListener:function(){var e=this,n=e._parent;n._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(n._sprite).length&&(n._sprite={__default:[0,1e3*n._duration]}),"loaded"!==n._state&&(n._state="loaded",n._emit("load"),n._loadQueue()),n._autoplay&&n.play(),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)}};var o={},a=function(e){var t=e._src;if(o[t])return e._duration=o[t].duration,void u(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),i=new Uint8Array(n.length),a=0;a<n.length;++a)i[a]=n.charCodeAt(a);s(i.buffer,e)}else{var d=new XMLHttpRequest;d.open("GET",t,!0),d.responseType="arraybuffer",d.onload=function(){var t=(d.status+"")[0];return"0"!==t&&"2"!==t&&"3"!==t?void e._emit("loaderror",null,"Failed loading audio file with status: "+d.status+"."):void s(d.response,e)},d.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete o[t],e.load())},r(d)}},r=function(e){try{e.send()}catch(t){e.onerror()}},s=function(e,n){t.ctx.decodeAudioData(e,function(e){e&&n._sounds.length>0&&(o[n._src]=e,u(n,e))},function(){n._emit("loaderror",null,"Decoding audio data failed.")})},u=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),e._autoplay&&e.play()},d=function(){t.noAudio=!1;try{"undefined"!=typeof AudioContext?t.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch(e){t.usingWebAudio=!1}if(!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(e=new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{var e=new Audio;e.muted&&(t.noAudio=!0)}catch(e){}var n=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),i=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),o=i?parseInt(i[1],10):null;if(n&&o&&o<9){var a=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());(t._navigator&&t._navigator.standalone&&!a||t._navigator&&!t._navigator.standalone&&!a)&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=void 0===t.ctx.createGain?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.value=1,t.masterGain.connect(t.ctx.destination)),t._setup()};"function"==typeof define&&define.amd&&define([],function(){return{Howler:t,Howl:n}}),"undefined"!=typeof exports&&(exports.Howler=t,exports.Howl=n),"undefined"!=typeof window?(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=i):"undefined"!=typeof global&&(global.HowlerGlobal=e,global.Howler=t,global.Howl=n,global.Sound=i)}(),function(e){function t(){}function n(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],s(e,this)}function i(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void n._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var i;try{i=n(e._value)}catch(e){return void a(t.promise,e)}o(t.promise,i)}else(1===e._state?o:a)(t.promise,e._value)}))}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof n)return e._state=3,e._value=t,void r(e);if("function"==typeof i)return void s(function(e,t){return function(){e.apply(t,arguments)}}(i,t),e)}e._state=1,e._value=t,r(e)}catch(t){a(e,t)}}function a(e,t){e._state=2,e._value=t,r(e)}function r(e){2===e._state&&0===e._deferreds.length&&n._immediateFn(function(){e._handled||n._unhandledRejectionFn(e._value)});for(var t=0,o=e._deferreds.length;t<o;t++)i(e,e._deferreds[t]);e._deferreds=null}function s(e,t){var n=!1;try{e(function(e){n||(n=!0,o(t,e))},function(e){n||(n=!0,a(t,e))})}catch(e){if(n)return;n=!0,a(t,e)}}var u=setTimeout;n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,n){var o=new this.constructor(t);return i(this,new function(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}(e,n,o)),o},n.all=function(e){var t=Array.prototype.slice.call(e);return new n(function(e,n){function i(a,r){try{if(r&&("object"==typeof r||"function"==typeof r)){var s=r.then;if("function"==typeof s)return void s.call(r,function(e){i(a,e)},n)}t[a]=r,0==--o&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var o=t.length,a=0;a<t.length;a++)i(a,t[a])})},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,n){n(e)})},n.race=function(e){return new n(function(t,n){for(var i=0,o=e.length;i<o;i++)e[i].then(t,n)})},n._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){u(e,0)},n._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},n._setImmediateFn=function(e){n._immediateFn=e},n._setUnhandledRejectionFn=function(e){n._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=n:e.Promise||(e.Promise=n)}(this);var DEBUG_MODE=!1,FPS=60,RANDOMIZE_INIT_STAT=!0,SCREEN_WIDTH=window.innerWidth>640?640:.9*window.innerWidth,RATIO=SCREEN_WIDTH/640,SCREEN_HEIGHT=Math.round(SCREEN_WIDTH/16*9),GRID_NUM=14,NOTE_WIDTH=SCREEN_WIDTH/GRID_NUM*.2,NOTE_HEIGHT=30*RATIO,RESULT_OPT_POSITION=.66*SCREEN_HEIGHT,NOTE_POS_SPAN=Math.round(SCREEN_WIDTH/GRID_NUM),JUDGE_LINE_Y=.7*SCREEN_HEIGHT|0,EFFECT_HEIGHT=.3*JUDGE_LINE_Y,NOTE_COLOR="rgb(139, 236, 242)",LONG_NOTE_COLOR="rgb(77, 60, 212)",WATER_COLOR="#125779",FILTER_COLOR="rgba(164, 146, 146, 0.59)",THEME_COLOR={day:"#62bcb8",evening:"#e2441d",night:"black"},DEFAULT_COLOR="rgb(60, 100, 214)",ACTIVE_COLOR="rgb(161, 182, 241)",DEFAULT_OPACITY=.5,RATING_TEXT_POS_X=.5*SCREEN_WIDTH,RATING_TEXT_POS_Y=.4*SCREEN_HEIGHT,SCORE_TEXT_FONT_SIZE=20*RATIO,SCORE_TEXT_POS_X=.9*SCREEN_WIDTH,SCORE_TEXT_POS_Y=1.25*SCORE_TEXT_FONT_SIZE,PROGRESSBAR_X=10*RATIO,PROGRESSBAR_Y=10*RATIO,PROGRESSBAR_WIDTH=.6*SCREEN_WIDTH|0,PROGRESSBAR_HEIGHT=8*RATIO,LIGHT_POS_X=60*RATIO,LIGHT_POS_Y=110*RATIO,GIRL_POS_X=.75*SCREEN_WIDTH,GIRL_POS_Y=75*RATIO,RATING_DATA_MAP={miss:{message:"MISS...",effectTime:8,color:"gray"},hold:{effectTime:4,color:"#C2FAEF"},out:{range:.13},good:{range:.1,message:"GOOD",effectTime:20,score:10,color:"#7FBBCA",sound:"conga"},nice:{range:.054,message:"NICE!",effectTime:20,score:50,color:"#EA9447",sound:"clap"},great:{range:.032,message:"GREAT!!",effectTime:25,score:100,color:"#5DF3EE",sound:"clap"}},SOUND_ASSETS={clap:"./assets/sounds/clap.mp3",conga:"./assets/sounds/conga.mp3",empty:"./assets/sounds/snap.mp3"},IMAGE_ASSETS={streetLight:"./assets/images/streetLight2.png",girl:"./assets/images/girl.png"},MUSIC_LIST_PATH="../data/music_list.json",DATA_PATH="../data/",createCounter=createCounter;!function(e){function t(e){return document.getElementById(e)}function n(e){var t=e,n=Math.max(Math.max(document.body.clientHeight,document.body.scrollHeight),Math.max(document.documentElement.scrollHeight,document.documentElement.clientHeight));t.style.height=n+"px";var i=Math.max(Math.max(document.body.clientWidth,document.body.scrollWidth),Math.max(document.documentElement.scrollWidth,document.documentElement.clientWidth));t.style.width=i+"px"}var i=function(){this.canvas=t("app"),this.game=new e.Game(this),this.music=null,this.musicList,this.noteSpeed=0,this.enableInput=!0,this.refs={musicDetail:t("music-info"),repertoryList:t("repertory"),repertoryWrapper:t("repertory-wrapper"),musicNameDisplay:t("music-name-display"),filterElement:t("load-filter"),gameField:t("game-field"),pauseBtn:t("pause-btn"),autoPlayBtn:t("autoplay-btn"),randomizeBtn:t("randomize-btn"),optionArea:t("option-area"),resultOptions:t("result-options"),twitterShareBtn:t("twitter-share-btn")};var n=t("debug-container");DEBUG_MODE||n.parentNode.removeChild(n),this._init()};i.prototype={_init:function(){this.refs.gameField.style.width=SCREEN_WIDTH+"px",this.refs.gameField.style.height=SCREEN_HEIGHT+"px",n(this.refs.filterElement),window.addEventListener("resize",function(){n(this.refs.filterElement)}.bind(this)),this.changeState("initial"),this.toggleLoadingState(!0),RRAIN.Loader.loadBatch({image:IMAGE_ASSETS,sound:SOUND_ASSETS,json:{musicList:MUSIC_LIST_PATH}}).then(this.init.bind(this)).catch(function(e){this.toggleLoadingState(!1),alert("アセットのロードに失敗しました "+e)}.bind(this))},init:function(){this.toggleLoadingState(!1);var e=this.musicList=RRAIN.Loader.getAsset("musicList").data.list;this._setupInputEvent(),this._setupRepertoryList(e),this._setupOptions(),this.refs.resultOptions.style.top=RESULT_OPT_POSITION+"px",this.refs.randomizeBtn.checked=RANDOMIZE_INIT_STAT,this.game.init(),this._checkBrowserSupport()},_checkBrowserSupport:function(){var e=navigator.userAgent.toLowerCase();(e.indexOf("android")>0||e.indexOf("MSIE")>0||e.indexOf("trident")>0)&&(alert("ご使用のブラウザは推奨環境下ではありません。\nGoogle chrome (PC)、もしくはiOS safariでのプレイをオススメします"),this.toggleSE(!1))},setTwitterShareLink:function(e){var t=encodeURIComponent,n="https://twitter.com/share?"+["text="+t("☔ - "+this.music._musicName+" スコア： "+e),"hashtags="+t("リズミックレイン"),"url="+t(location.href)].join("&");this.refs.twitterShareBtn.onclick=function(){window.open(n,"share window","width=480, height=320")}},_setupInputEvent:function(){var e=this,t=function(t){if(e.enableInput)if("playing"===e.game.playState)e.game.pointstart&&e.game.pointstart(t);else if("pause"===e.game.playState)e.changeState("playing"),e.game.play();else{if(!e.music)return;e.music.stop(),e.game.reset(),e.game.play(),e.changeState("playing")}};this.canvas.addEventListener("mousedown",function(e){e.preventDefault(),t(e)},!1),this.canvas.addEventListener("touchstart",function(e){e.preventDefault(),t(e)},!1),document.addEventListener("keydown",function(e){t(e)});var n=function(t){t.preventDefault(),e.game.pointend&&"playing"===e.game.playState&&e.game.pointend(t)};this.canvas.addEventListener("mouseup",n,!1),this.canvas.addEventListener("touchend",n,!1),document.addEventListener("keyup",n,!1),this.refs.pauseBtn.addEventListener("click",this._togglePause.bind(this),!1),this.refs.autoPlayBtn.onchange=function(t){e.game.isAutoPlay=t.target.checked},this.refs.randomizeBtn.onchange=function(t){t.target.checked?e.game.setNotePositions(!0):e.game.setNotePositions()}},_setupOptions:function(){var e=createCounter({label:"SPEED",callback:this.varyNoteSpeed.bind(this),buttonClass:"t-blue",width:40});this.refs.optionArea.appendChild(e),e=createCounter({label:"ADJUST",callback:this.adjustTiming.bind(this),buttonClass:"t-green",width:40}),this.refs.optionArea.appendChild(e)},_togglePause:function(){"pause"===this.game.playState?(this.changeState("playing"),this.game.play()):(this.changeState("pause"),this.game.pause())},_setupRepertoryList:function(e){var t=this;e.forEach(function(e){function n(n){function i(){t.toggleLoadingState(!1),t.music.play(),t.music._musicName=e.name,t.game.setMusic(t.music),t.game.reset(),t.refs.musicNameDisplay.innerHTML="♪ "+e.name}t.music&&t.music.stop(),t.updateMusicDetail(e);var o=t.refs.repertoryList.childNodes;(o=Array.prototype.slice.call(o)).forEach(function(e){var t=e.style;t.background=DEFAULT_COLOR,t.opacity=.5}),n.target.style.background=ACTIVE_COLOR,n.target.style.opacity=1;var a=RRAIN.Loader.getAsset(e.name);if(a)t.music=a,t.game.setupGame(RRAIN.Loader.getAsset("chart_"+e.name).data),i();else{t.toggleLoadingState(!0);var r=RRAIN.Loader.loadSound(DATA_PATH+e.src,e.name).then(function(e){t.music=e}).catch(function(e){alert("音源のロードに失敗しました"+e),t.toggleLoadingState(!1)}),s=RRAIN.Loader.loadJson(DATA_PATH+e.fumen,"chart_"+e.name).then(function(e){t.game.setupGame(e.data)}).catch(function(e){alert("譜面のロードに失敗しました"+e),t.toggleLoadingState(!1)});Promise.all([r,s]).then(i)}}var i=document.createElement("li");i.textContent=e.name,i.style.background=DEFAULT_COLOR,i.style.opacity=DEFAULT_OPACITY,i.addEventListener("mousedown",n,!1),i.addEventListener("touchstart",n,!1),t.refs.repertoryList.appendChild(i)})},updateMusicDetail:function(e){for(var t=this.refs.musicDetail;t.hasChildNodes();)t.removeChild(t.firstChild);Object.keys(e).forEach(function(n){if("src"!==n&&"fumen"!==n&&"url"!==n){var i=e[n],o=document.createElement("li");if("author"===n){var a=document.createElement("a");a.setAttribute("href",e.url),a.setAttribute("target","_blank"),a.innerText=i,o.innerText="ARTIST: ",o.appendChild(a)}else if("difficulty"===n){o.innerHTML+=n.toUpperCase()+": ";for(var r=0;r<i;r++)o.innerHTML+="&#9733"}else o.textContent=n.toUpperCase()+": "+e[n];t.appendChild(o)}}.bind(this))},toggleSE:function(e){this.game.enableSE=null!=e?e:!this.game.enableSE},varyNoteSpeed:function(e){this.game.setNoteSpeed(e)},adjustTiming:function(e){this.game.adjustTiming(e)},changeState:function(e){switch(this.game.playState=e,e){case"pause":this.refs.repertoryWrapper.style.display="block",this.refs.pauseBtn.style.visibility="hidden";break;case"playing":this.refs.repertoryWrapper.style.display="none",this.refs.pauseBtn.style.visibility="visible",this.refs.resultOptions.style.visibility="hidden";break;case"idle":this.refs.repertoryWrapper.style.display="block",this.refs.pauseBtn.style.visibility="hidden",this.refs.resultOptions.style.visibility="visible";break;default:this.refs.pauseBtn.style.visibility="hidden",this.refs.resultOptions.style.visibility="hidden"}},toggleLoadingState:function(e){var t;e?(t="visible",this.enableInput=!1):(t="hidden",this.enableInput=!0),this.refs.filterElement.style.visibility=t}},e.App=i}(RRAIN=RRAIN||{}),function(e){var t=function(){return document.createElement("div")},n=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])},i=function(e){var i=0,o=e.label,a=e.callback,r=e.width||40,s=.55*r,u=.3*r|0,d=e.unit||1,_=e.buttonClass||"",l=t();n(l,{display:"inline-block",textAlign:"center",width:r+"px"});var c=t();c.name=o+"-label",c.innerText=o,n(c,{width:"inherit",textAlign:"center",fontSize:.8*u+"px"}),l.appendChild(c);var f=t();f.onclick=function(e){i+=d,h.innerText=i,a(i)},n(f,{width:"inherit",height:s+"px",textAlign:"center",lineHeight:s+"px",verticalAlign:"middle",borderRadius:r+"px "+r+"px 0 0",fontSize:u+"px",cursor:"pointer",userSelect:"none"}),f.innerText="+",f.className=_,l.appendChild(f);var h=t();h.innerText=i,n(h,{width:"inherit",textAlign:"center",fontSize:u+"px"}),l.appendChild(h);var p=t();return p.onclick=function(e){i-=d,h.innerText=i,a(i)},n(p,{width:r+"px",height:s+"px",textAlign:"center",fontSize:u+"px",verticalAlign:"middle",borderRadius:"0 0 "+r+"px "+r+"px",lineHeight:s+"px",cursor:"pointer",userSelect:"none"}),p.innerText="-",p.className=_,l.appendChild(p),l};window.createCounter=i,"undefined"!=typeof module&&(module.exports=i)}();!function(e){function t(e,t,n,i,o,a){e.save();var r=e.createLinearGradient(t,n,t,n+o);if(a.length>0)for(var s=0,u=a.length;s<u;s++)r.addColorStop(a[s][0],a[s][1]);else r.addColorStop(0,"rgba(0, 0, 0, 0)"),r.addColorStop(1,a);e.fillStyle=r,e.fillRect(t,n,i,o),e.restore()}var n=function(e){this.timer=new Timer,this.canvas=e.canvas,this._bufferCanvas=document.createElement("canvas"),this.app=e,this.music=null,this._bpm=120,this.wait=2.3,this._theme="night",this._currentNoteIndex=0,this._activeLongNote=null,this._hitEffects=[],this._noteList=[],this._adjustedGap=0,this._noteSpeedRate=1,this.score=0,this._chainNum=0,this._maxChain=0,this._fullChainNum=0,this.isAutoPlay=!1,this.playState="initial",this._isPressed=!0,this.enableSE=!0,this._notePositions=[],this._notePositionsLen=0,this.setNotePositions(RANDOMIZE_INIT_STAT)};n.prototype={init:function(){this._initCanvas(),this._loop()},_initCanvas:function(){var e=RRAIN.Loader.getAsset("girl"),n=RRAIN.Loader.getAsset("streetLight"),i=this.canvas.width=this._bufferCanvas.width=SCREEN_WIDTH,o=this.canvas.height=this._bufferCanvas.height=SCREEN_HEIGHT,a=this._bufferCanvas.getContext("2d");a.drawImage(e,GIRL_POS_X,GIRL_POS_Y,136.4*RATIO,166*1.1*RATIO),t(a,0,JUDGE_LINE_Y,i,o-JUDGE_LINE_Y,[[0,WATER_COLOR],[1,"rgba(255, 255, 255, 0)"]]),a.drawImage(n,LIGHT_POS_X,LIGHT_POS_Y,132*RATIO,358*RATIO),a.fillStyle=FILTER_COLOR,a.fillRect(0,0,i,o)},_loop:function(){"playing"===this.playState&&this._update(),this._render(),setTimeout(this._loop.bind(this),1e3/FPS)},_update:function(){this.timer.update();var e,t,n,i,o=this._noteList,a=this.timer.time();for(this.isAutoPlay&&(this._isPressed=!0),!this.music._played&&this.wait-this.zerohour<a&&(this.music.play(),this.music._played=!0),e=this._currentNoteIndex,t=o.length;e<t;e++)(n=o[e]).length?n=n[0]+this._adjustedGap:n+=this._adjustedGap,this.isAutoPlay&&!this._activeLongNote&&n+this.wait-.5*RATING_DATA_MAP.great.range<a&&this._judge(),null==this._activeLongNote&&n+this.wait+RATING_DATA_MAP.good.range<a&&this._judge();null!=this._activeLongNote&&(i=this._activeLongNote-a,this._isPressed?0<i||(this._reaction("great"),this._activeLongNote=null,this._currentNoteIndex++):(this._reaction("miss"),this._activeLongNote=null,this._currentNoteIndex++))},_render:function(){var e,n,i,o,a,r=this.canvas.getContext("2d"),s=this._noteList,u=s.length,d=this._bufferCanvas,_=this.timer,l=1.75*this._bpm*RATIO*this._noteSpeedRate,c=0,f=100;for(r.clearRect(0,0,this.canvas.width,this.canvas.height),r.fillStyle=THEME_COLOR[this._theme],r.fillRect(0,0,this.canvas.width,this.canvas.height),r.drawImage(d,0,0,d.width,d.height),r.save(),i=this._currentNoteIndex,u=s.length;i<u;i++)f=this._notePositions[i%this._notePositionsLen],(a=s[i]).length?(r.fillStyle=LONG_NOTE_COLOR,e=-(a[1]-a[0])*l,a=a[0]):(e=l<0?NOTE_HEIGHT:-NOTE_HEIGHT,r.fillStyle=NOTE_COLOR),c=(a+=this.wait+this._adjustedGap)-_.time(),(n=JUDGE_LINE_Y-c*l)<-10||(c<0&&(e-=c*l,n=JUDGE_LINE_Y),r.fillRect(f,n,NOTE_WIDTH,e));if(r.restore(),r.fillStyle="white",r.font=SCORE_TEXT_FONT_SIZE+"px 'Audiowide'",r.textAlign="center","playing"===this.playState){for(0!==this._chainNum&&r.fillText(this._chainNum+" CHAIN",RATING_TEXT_POS_X,RATING_TEXT_POS_Y+16),r.textAlign="right",r.fillText(this.score,SCORE_TEXT_POS_X,SCORE_TEXT_POS_Y),i=this._hitEffects.length-1;i>=0;i-=1)o=this._hitEffects[i],r.save(),r.globalAlpha=.1*o.life,t(r,o.posX,JUDGE_LINE_Y-EFFECT_HEIGHT,NOTE_WIDTH,EFFECT_HEIGHT,[[0,"rgba(0, 0, 0, 0)"],[1,o.color]]),o.life--,o.life<0&&this._hitEffects.splice(i,1),r.restore(),r.save(),r.globalAlpha=.1*o.life,r.textAlign="center",r.fillStyle=o.color,r.fillText(o.message,o.posX+NOTE_WIDTH/2,.8*JUDGE_LINE_Y),r.restore();r.save();var h=this.music.seek()/this.endhour;h=Math.min(h,1),r.fillStyle="#d5e9f1",r.fillRect(PROGRESSBAR_X,PROGRESSBAR_Y,PROGRESSBAR_WIDTH,PROGRESSBAR_HEIGHT),r.fillStyle="#5099b6",r.fillRect(PROGRESSBAR_X,PROGRESSBAR_Y,PROGRESSBAR_WIDTH*h,PROGRESSBAR_HEIGHT),r.restore()}else r.save(),r.fillStyle="rgba(0, 0, 0, 0.7)",r.fillRect(0,0,SCREEN_WIDTH,SCREEN_HEIGHT),r.textAlign="center",r.fillStyle="rgba(255, 255, 255, 0.99)",r.globalAlpha=.4,r.fillText("TAP KEYBOARD or SCREEN to PLAY/RESUME",RATING_TEXT_POS_X,2*SCORE_TEXT_FONT_SIZE),r.globalAlpha=1,0!=this.score&&(r.save(),r.fillStyle="#45C1F4","pause"===this.playState?r.fillText("PAUSE",RATING_TEXT_POS_X,RATING_TEXT_POS_Y):r.fillText("RESULT",RATING_TEXT_POS_X,RATING_TEXT_POS_Y),r.restore(),r.fillText("SCORE: "+this.score,RATING_TEXT_POS_X,RATING_TEXT_POS_Y+1.5*SCORE_TEXT_FONT_SIZE),r.fillText("MAX-CHAIN: "+this._maxChain+" / "+this._fullChainNum,RATING_TEXT_POS_X,RATING_TEXT_POS_Y+3*SCORE_TEXT_FONT_SIZE)),r.restore()},setNoteSpeed:function(e){var t=1+.125*e;this._noteSpeedRate=t},setNotePositions:function(e){this._notePositions=function(e,t,n,i){for(var o=[],a=t;a<t+n;a++)o.push(e*a);if(!0===i)for(a=0;a<o.length;a++)!function(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}(o,a,Math.random()*(o.length-a)+a|0);return o}(NOTE_POS_SPAN,4,8,e),this._notePositionsLen=this._notePositions.length},adjustTiming:function(e){this._adjustedGap=e/1e3},setMusic:function(e){e.on("end",this.end.bind(this)),this.music=e,this.endhour=e.duration()},setupGame:function(e){this._noteList=[].concat(e.noteList),this._bpm=e.BPM,this.zerohour=e.zerohour,this._theme=e.theme||"night",this._fullChainNum=0,e.noteList.forEach(function(e){e.length?this._fullChainNum+=2:this._fullChainNum++}.bind(this))},reset:function(){this._currentNoteIndex=0,this.music._played=!1,this.timer.reset(),this._chainNum=0,this._maxChain=0,this.score=0,this._hitEffects=[],this.playState="idle"},play:function(){0!==this.music.seek()&&(this.timer.setTime(this.music.seek()-this.zerohour+this.wait),this.music.play()),this.timer.run(),this.playState="playing"},pause:function(){this.music.pause(),this.timer.pause(),this.playState="pause"},end:function(){this.app.changeState("idle"),this.timer.pause(),this.app.setTwitterShareLink(this.score)},_judge:function(e){if(void 0!==(e=e||this._noteList[this._currentNoteIndex])){var t,n=this._reaction.bind(this);"object"==typeof e&&(t=e[1]+this.wait+this._adjustedGap,e=e[0]);var i=(e+=this.wait+this._adjustedGap)-this.timer.time(),o=Math.abs(i),a=RATING_DATA_MAP;if(!(a.out.range<i))return t&&(this._activeLongNote=t),o<a.great.range?n("great"):o<a.nice.range?n("nice"):o<a.good.range?n("good"):(this._activeLongNote=null,n("miss"));this._playShot("empty")}else this._playShot("empty")},_reaction:function(e){var t=RATING_DATA_MAP[e],n=this._notePositions[this._currentNoteIndex%this._notePositionsLen];"miss"!==e?"hold"===e?this._hitEffects.push({life:t.effectTime,posX:n,color:t.color,message:""}):(this._chainNum++,this._playShot(t.sound),this._hitEffects.push({life:t.effectTime,posX:n,color:t.color,message:t.message}),this.score+=t.score):(this._chainNum=0,this._hitEffects.push({life:t.effectTime,posX:n,color:t.color,message:t.message})),null==this._activeLongNote&&this._currentNoteIndex++,this._maxChain=Math.max(this._chainNum,this._maxChain)},_playShot:function(e){this.enableSE&&RRAIN.Loader.getAsset(e).play()},pointstart:function(){this.isAutoPlay||this._isPressed||(this._isPressed=!0,this._judge())},pointend:function(){!this.isAutoPlay&&this._isPressed&&(this._isPressed=!1)}},e.Game=n}(RRAIN=RRAIN||{});var RRAIN=RRAIN||{};!function(e){var t={get LOADFUNC_MAP(){return{image:this.loadImage,json:this.loadJson,sound:this.loadSound}},_registered:{},getAsset:function(e){return null!=this._registered[e]&&this._registered[e]},loadBatch:function(e){var t=new Array,n=this;return Object.keys(e).forEach(function(i){Object.keys(e[i]).forEach(function(o){var a=e[i][o],r=n.LOADFUNC_MAP[i].bind(n);t.push(r(a,o))})}),Promise.all(t)},loadSound:function(e,t){var n=this;{if("undefined"!=typeof Howl)return new Promise(function(i,o){var a=new Howl({src:[e],onload:function(){n._registered[t]=a,i(a)},onloaderror:function(e){o(e)}})});console.error("Howler.js is not load")}},loadImage:function(e,t){var n=this;return new Promise(function(i,o){var a=new Image;a.onload=function(){n._registered[t]=a,i(a)},a.onerror=function(e){o(e)},a.src=e})},loadJson:function(e,t){var n=this;return new Promise(function(i,o){var a=new XMLHttpRequest;a.open("get",e,!0),a.setRequestHeader("Pragma","no-cache"),a.setRequestHeader("Cache-Control","no-cache"),a.setRequestHeader("If-Modified-Since","Thu, 01 Jun 1970 00:00:00 GMT"),a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){var e={raw:a.responseText,data:JSON.parse(a.responseText)};i(e),n._registered[t]=e}},a.onerror=function(e){i(e)},a.send(null)})}};RRAIN.Loader=t}(),window.addEventListener?window.addEventListener("load",shareButtonReadSyncer,!1):window.attachEvent("onload",shareButtonReadSyncer),function(e){var t=function(){this._time=0,this.isStop=!1,this._past=0};t.prototype.run=function(){this.isStop=!1},t.prototype.update=function(){this.isStop||(this._past?(this._time+=Date.now()-this._past,this._past=Date.now()):this._past=Date.now())},t.prototype.toggle=function(){this.isStop=!this.isStop,this._past=0},t.prototype.pause=function(){this.isStop=!0,this._past=0},t.prototype.setTime=function(e){this._time=1e3*e,this._past=0},t.prototype.reset=function(){this._time=0,this._past=0},t.prototype.time=function(){return this._time/1e3},e.Timer=t}(window),window.onload=function(){new RRAIN.App};